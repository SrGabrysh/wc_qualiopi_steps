
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport Tests WC Qualiopi Steps - 20250929_113414</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; }
        .header h1 { margin: 0; font-size: 2.5em; }
        .header .meta { opacity: 0.9; margin-top: 10px; }
        .stats { display: flex; justify-content: space-around; padding: 20px; background: #f8f9fa; }
        .stat { text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; }
        .stat-label { color: #666; margin-top: 5px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .content { padding: 30px; }
        .test-section { margin-bottom: 30px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
        .test-header { padding: 15px; font-weight: bold; font-size: 1.2em; }
        .test-header.success { background: #d4edda; color: #155724; }
        .test-header.error { background: #f8d7da; color: #721c24; }
        .test-content { padding: 20px; }
        .command { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; margin-bottom: 10px; }
        .output { background: #343a40; color: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 0.9em; max-height: 400px; overflow-y: auto; }
        .footer { text-align: center; padding: 20px; color: #666; border-top: 1px solid #dee2e6; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
        .badge-success { background: #28a745; color: white; }
        .badge-error { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª Rapport de Tests</h1>
            <div class="meta">
                <strong>WC Qualiopi Steps</strong><br>
                ğŸ“… 29/09/2025 Ã  11:37:26<br>
                ğŸ“ e:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-number success">3</div>
                <div class="stat-label">Tests RÃ©ussis</div>
            </div>
            <div class="stat">
                <div class="stat-number error">4</div>
                <div class="stat-label">Tests Ã‰chouÃ©s</div>
            </div>
            <div class="stat">
                <div class="stat-number">42.9%</div>
                <div class="stat-label">Taux de RÃ©ussite</div>
            </div>
            <div class="stat">
                <div class="stat-number">7</div>
                <div class="stat-label">Total Tests</div>
            </div>
        </div>
        
        <div class="content">

            <div class="test-section">
                <div class="test-header error">
                    Tests gÃ©nÃ©raux 
                    <span class="badge badge-error">Ã‰CHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> composer test</div>
                    
                    <div class="output">
  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   FAIL  Tests\Unit\MappingTest
  â¨¯ WCQS_Mapping â†’ it validates mapping configuration                                                                       0.71s  
  â¨¯ WCQS_Mapping â†’ it manages cache correctly                                                                               0.23s  
  â¨¯ WCQS_Mapping â†’ it gets complete mapping with cache                                                                      0.06s  
  â¨¯ WCQS_Mapping â†’ it applies default values to product configuration                                                       0.01s  
  â¨¯ WCQS_Mapping â†’ it migrates legacy gf_form_id to new structure                                                           0.01s  
  â¨¯ WCQS_Mapping â†’ it gets configuration for specific product                                                               0.01s  
  â¨¯ WCQS_Mapping â†’ it gets test URL for product                                                                             0.01s  
  â¨¯ WCQS_Mapping â†’ it checks if product has active test                                                                     0.01s  
  â¨¯ WCQS_Mapping â†’ it searches in mapping data                                                                              0.01s  
  â¨¯ WCQS_Mapping â†’ it gets all products with filtering                                                                      0.05s  
  â¨¯ WCQS_Mapping â†’ it provides mapping statistics                                                                           0.03s  
  â¨¯ WCQS_Mapping â†’ it handles corrupted mapping data gracefully                                                             0.01s  
  âœ“ WCQS_Mapping â†’ it returns null for non-existent product                                                                 0.09s  

   PASS  Tests\Unit\CheckoutDecisionTest
  âœ“ CheckoutDecision â†’ it allows checkout when enforcement is disabled                                                      0.16s  
  âœ“ CheckoutDecision â†’ it allows checkout when no active mapping
  âœ“ CheckoutDecision â†’ it allows checkout with valid temporary token
  âœ“ CheckoutDecision â†’ it allows checkout when test is solved in session
  âœ“ CheckoutDecision â†’ it allows checkout when test is validated in usermeta
  âœ“ CheckoutDecision â†’ it prioritizes temporary token over session validation
  âœ“ CheckoutDecision â†’ it prioritizes session over usermeta validation
  âœ“ CheckoutDecision â†’ it handles multiple products correctly                                                               0.01s  
  âœ“ CheckoutDecision â†’ it ignores usermeta validation for anonymous users
  âœ“ CheckoutDecision â†’ it provides helper methods for decision checking
  âœ“ CheckoutDecision â†’ it converts to array for logging
  âœ“ CheckoutDecision â†’ it allows checkout when no product in cart
  âœ“ CheckoutDecision â†’ it blocks checkout when no validation proof exists

   PASS  Tests\Unit\ExampleTest
  âœ“ example                                                                                                                 0.01s  

   PASS  Tests\Unit\SessionTest
  âœ“ WCQS_Session â†’ it sets and checks solved status                                                                         0.01s  
  âœ“ WCQS_Session â†’ it provides detailed session information
  âœ“ WCQS_Session â†’ it cannot extend nonexistent sessions
  âœ“ WCQS_Session â†’ it handles multiple products independently
  âœ“ WCQS_Session â†’ it can unset solved status
  âœ“ WCQS_Session â†’ it can extend existing sessions                                                                          0.01s  
  âœ“ WCQS_Session â†’ it respects custom TTL                                                                                   2.01s  
  âœ“ WCQS_Session â†’ it cleans up expired sessions                                                                            2.05s  
  âœ“ WCQS_Session â†’ it provides session statistics                                                                           2.01s  
  âœ“ WCQS_Session â†’ it lists all active sessions                                                                             2.09s  

   PASS  Tests\Unit\SimpleTest
  âœ“ Simple Tests â†’ it can run basic assertions                                                                              0.01s  
  âœ“ Simple Tests â†’ it can test arrays
  âœ“ Simple Tests â†’ it can test PHP functions

   PASS  Tests\Unit\TokenTest
  âœ“ WCQS_Token â†’ it rejects token with wrong user_id                                                                        0.01s  
  âœ“ WCQS_Token â†’ it rejects token with wrong product_id
  âœ“ WCQS_Token â†’ it rejects corrupted tokens
  âœ“ WCQS_Token â†’ it rejects malformed tokens
  âœ“ WCQS_Token â†’ it uses base64url encoding
  âœ“ WCQS_Token â†’ it creates and verifies a valid token
  âœ“ WCQS_Token â†’ it creates token with default parameters
  âœ“ WCQS_Token â†’ it rejects expired tokens
  âœ“ WCQS_Token â†’ it handles key rotation correctly
  âœ“ WCQS_Token â†’ it generates incremental key versions
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it validates mapping configuration                                    Error   
  Call to undefined method stdClass::get_status()

  at src\Utils\WCQS_Mapping.php:201
    197â–• 		if ( $product_id <= 0 ) {
    198â–• 			$errors[] = __( 'Product ID is required', 'wc_qualiopi_steps' );
    199â–• 		} else {
    200â–• 			$product = wc_get_product( $product_id );
  âœ 201â–• 			if ( ! $product || $product->get_status() !== 'publish' ) {
    202â–• 				$errors[] = __( 'Product must exist and be published', 'wc_qualiopi_steps' );
    203â–• 			}
    204â–• 		}
    205â–•

  1   src\Utils\WCQS_Mapping.php:201
  2   tests\Unit\MappingTest.php:204

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it manages cache correctly                                                    
  Failed asserting that an array has the key 'product_123'

  at tests\Unit\MappingTest.php:279
    275â–• 
    276â–•     it('manages cache correctly', function () {
    277â–•         // Premier accÃ¨s - charge depuis DB
    278â–•         $mapping1 = WCQS_Mapping::get_mapping();
  âœ 279â–•         expect($mapping1)->toHaveKey('product_123');
    280â–• 
    281â–•         // Modifier l'option directement (simulation changement externe)
    282â–•         $this->setOption('wcqs_testpos_mapping', ['_version' => 2, 'product_999' => []]);
    283â–•

  1   tests\Unit\MappingTest.php:279

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets complete mapping with cache                                           
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:46
     42â–•         $mapping2 = WCQS_Mapping::get_mapping(); // DeuxiÃ¨me appel depuis cache
     43â–• 
     44â–•         expect($mapping1)
     45â–•             ->toBeArray()
  âœ  46â–•             ->toHaveKey('_version', 1)
     47â–•             ->toHaveKey('product_123')
     48â–•             ->toHaveKey('product_124');
     49â–• 
     50â–•         expect($mapping2)->toBe($mapping1); // MÃªme rÃ©fÃ©rence = cache utilisÃ©

  1   tests\Unit\MappingTest.php:46

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it applies default values to product configuration                            
  Failed asserting that an array has the key 'product_id'

  at tests\Unit\MappingTest.php:84
     80â–• 
     81â–•         $config = WCQS_Mapping::get_for_product(100);
     82â–• 
     83â–•         expect($config)
  âœ  84â–•             ->toHaveKey('product_id', 100)
     85â–•             ->toHaveKey('page_id', 200)
     86â–•             ->toHaveKey('form_source', 'learndash') // DÃ©faut
     87â–•             ->toHaveKey('form_ref', '') // DÃ©faut
     88â–•             ->toHaveKey('active', false) // DÃ©faut

  1   tests\Unit\MappingTest.php:84

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it migrates legacy gf_form_id to new structure                                
  Failed asserting that an array has the key 'form_source'

  at tests\Unit\MappingTest.php:106
    102â–• 
    103â–•         $config = WCQS_Mapping::get_for_product(200);
    104â–• 
    105â–•         expect($config)
  âœ 106â–•             ->toHaveKey('form_source', 'gravityforms')
    107â–•             ->toHaveKey('form_ref', '42')
    108â–•             ->not()->toHaveKey('gf_form_id'); // SupprimÃ© aprÃ¨s migration
    109â–•     });
    110â–•

  1   tests\Unit\MappingTest.php:106

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets configuration for specific product                                    
  Failed asserting that null is of type array.

  at tests\Unit\MappingTest.php:57
     53â–•     it('gets configuration for specific product', function () {
     54â–•         $config = WCQS_Mapping::get_for_product(123);
     55â–• 
     56â–•         expect($config)
  âœ  57â–•             ->toBeArray()
     58â–•             ->toHaveKey('product_id', 123)
     59â–•             ->toHaveKey('page_id', 456)
     60â–•             ->toHaveKey('form_source', 'learndash')
     61â–•             ->toHaveKey('form_ref', '789')

  1   tests\Unit\MappingTest.php:57

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets test URL for product                                                  
  Failed asserting that null is of type string.

  at tests\Unit\MappingTest.php:148
    144â–•         }
    145â–• 
    146â–•         $url = WCQS_Mapping::get_test_url(123);
    147â–•         expect($url)
  âœ 148â–•             ->toBeString()
    149â–•             ->toContain('https://example.com/test-page')
    150â–•             ->toContain('product_id=123');
    151â–• 
    152â–•         // Avec paramÃ¨tres personnalisÃ©s

  1   tests\Unit\MappingTest.php:148

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it checks if product has active test                                          
  Failed asserting that false is true.

  at tests\Unit\MappingTest.php:125
    121â–•                 return null;
    122â–•             }
    123â–•         }
    124â–• 
  âœ 125â–•         expect(WCQS_Mapping::has_active_test(123))->toBeTrue(); // Active + page existe
    126â–•         expect(WCQS_Mapping::has_active_test(124))->toBeFalse(); // Inactif
    127â–•         expect(WCQS_Mapping::has_active_test(125))->toBeFalse(); // Page manquante
    128â–•         expect(WCQS_Mapping::has_active_test(999))->toBeFalse(); // Produit inexistant
    129â–•     });

  1   tests\Unit\MappingTest.php:125

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it searches in mapping data                                                   
  Failed asserting that an array has the key '123'

  at tests\Unit\MappingTest.php:264
    260â–• 
    261â–•         $results = WCQS_Mapping::search('WordPress');
    262â–•         expect($results)
    263â–•             ->toBeArray()
  âœ 264â–•             ->toHaveKey(123); // Formation WordPress trouvÃ©e
    265â–• 
    266â–•         $results_php = WCQS_Mapping::search('PHP');
    267â–•         expect($results_php)->toHaveKey(124);
    268â–•

  1   tests\Unit\MappingTest.php:264

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets all products with filtering                                           
  Failed asserting that actual size 0 matches expected size 3.

  at tests\Unit\MappingTest.php:167
    163â–•     it('gets all products with filtering', function () {
    164â–•         $all_products = WCQS_Mapping::get_all_products();
    165â–•         expect($all_products)
    166â–•             ->toBeArray()
  âœ 167â–•             ->toHaveCount(3)
    168â–•             ->toHaveKey(123)
    169â–•             ->toHaveKey(124)
    170â–•             ->toHaveKey(125);
    171â–•

  1   tests\Unit\MappingTest.php:167

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it provides mapping statistics                                                
  Failed asserting that 0 matches expected 3.

  at tests\Unit\MappingTest.php:226
    222â–•         $stats = WCQS_Mapping::get_stats();
    223â–• 
    224â–•         expect($stats)
    225â–•             ->toBeArray()
  âœ 226â–•             ->toHaveKey('total', 3)
    227â–•             ->toHaveKey('active', 2)
    228â–•             ->toHaveKey('inactive', 1)
    229â–•             ->toHaveKey('problematic')
    230â–•             ->toHaveKey('health_score');

  1   tests\Unit\MappingTest.php:226

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it handles corrupted mapping data gracefully                                  
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:312
    308â–• 
    309â–•         $mapping = WCQS_Mapping::get_mapping();
    310â–•         expect($mapping)
    311â–•             ->toBeArray()
  âœ 312â–•             ->toHaveKey('_version', 1); // Fallback appliquÃ©
    313â–• 
    314â–•         // Configuration produit corrompue
    315â–•         $this->setOption('wcqs_testpos_mapping', [
    316â–•             '_version' => 1,

  1   tests\Unit\MappingTest.php:312


  Tests:    12 failed, 38 passed (169 assertions)
  Duration: 17.26s

</div>
                    <div class="output" style="background: #721c24;"><strong>ERREUR:</strong><br>Script pest handling the test event returned with error code 2
</div>
                </div>
            </div>

            <div class="test-section">
                <div class="test-header error">
                    Tests unitaires uniquement 
                    <span class="badge badge-error">Ã‰CHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> composer test:unit</div>
                    
                    <div class="output">
  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   FAIL  Tests\Unit\MappingTest
  â¨¯ WCQS_Mapping â†’ it validates mapping configuration                                                                       0.74s  
  â¨¯ WCQS_Mapping â†’ it searches in mapping data                                                                              0.32s  
  â¨¯ WCQS_Mapping â†’ it applies default values to product configuration                                                       0.01s  
  â¨¯ WCQS_Mapping â†’ it migrates legacy gf_form_id to new structure                                                           0.01s  
  â¨¯ WCQS_Mapping â†’ it gets configuration for specific product                                                               0.02s  
  â¨¯ WCQS_Mapping â†’ it checks if product has active test                                                                     0.01s  
  â¨¯ WCQS_Mapping â†’ it gets test URL for product                                                                             0.01s  
  â¨¯ WCQS_Mapping â†’ it handles corrupted mapping data gracefully                                                             0.01s  
  â¨¯ WCQS_Mapping â†’ it provides mapping statistics                                                                           0.04s  
  â¨¯ WCQS_Mapping â†’ it gets all products with filtering                                                                      0.05s  
  â¨¯ WCQS_Mapping â†’ it gets complete mapping with cache                                                                      0.01s  
  â¨¯ WCQS_Mapping â†’ it manages cache correctly                                                                               0.01s  
  âœ“ WCQS_Mapping â†’ it returns null for non-existent product                                                                 0.10s  

   PASS  Tests\Unit\CheckoutDecisionTest
  âœ“ CheckoutDecision â†’ it allows checkout when no product in cart                                                           0.14s  
  âœ“ CheckoutDecision â†’ it allows checkout when no active mapping
  âœ“ CheckoutDecision â†’ it allows checkout with valid temporary token
  âœ“ CheckoutDecision â†’ it allows checkout when test is solved in session
  âœ“ CheckoutDecision â†’ it allows checkout when test is validated in usermeta
  âœ“ CheckoutDecision â†’ it blocks checkout when no validation proof exists                                                   0.02s  
  âœ“ CheckoutDecision â†’ it prioritizes temporary token over session validation
  âœ“ CheckoutDecision â†’ it prioritizes session over usermeta validation
  âœ“ CheckoutDecision â†’ it ignores usermeta validation for anonymous users
  âœ“ CheckoutDecision â†’ it provides helper methods for decision checking
  âœ“ CheckoutDecision â†’ it converts to array for logging
  âœ“ CheckoutDecision â†’ it handles multiple products correctly
  âœ“ CheckoutDecision â†’ it allows checkout when enforcement is disabled

   PASS  Tests\Unit\ExampleTest
  âœ“ example                                                                                                                 0.01s  

   PASS  Tests\Unit\SessionTest
  âœ“ WCQS_Session â†’ it can unset solved status                                                                               0.05s  
  âœ“ WCQS_Session â†’ it provides detailed session information
  âœ“ WCQS_Session â†’ it cannot extend nonexistent sessions
  âœ“ WCQS_Session â†’ it handles multiple products independently
  âœ“ WCQS_Session â†’ it sets and checks solved status
  âœ“ WCQS_Session â†’ it can extend existing sessions                                                                          0.01s  
  âœ“ WCQS_Session â†’ it respects custom TTL                                                                                   2.00s  
  âœ“ WCQS_Session â†’ it provides session statistics                                                                           2.03s  
  âœ“ WCQS_Session â†’ it cleans up expired sessions                                                                            2.01s  
  âœ“ WCQS_Session â†’ it lists all active sessions                                                                             2.08s  

   PASS  Tests\Unit\SimpleTest
  âœ“ Simple Tests â†’ it can run basic assertions                                                                              0.01s  
  âœ“ Simple Tests â†’ it can test arrays
  âœ“ Simple Tests â†’ it can test PHP functions

   PASS  Tests\Unit\TokenTest
  âœ“ WCQS_Token â†’ it creates and verifies a valid token                                                                      0.01s  
  âœ“ WCQS_Token â†’ it creates token with default parameters
  âœ“ WCQS_Token â†’ it rejects expired tokens
  âœ“ WCQS_Token â†’ it rejects token with wrong user_id
  âœ“ WCQS_Token â†’ it rejects token with wrong product_id
  âœ“ WCQS_Token â†’ it rejects corrupted tokens
  âœ“ WCQS_Token â†’ it rejects malformed tokens
  âœ“ WCQS_Token â†’ it handles key rotation correctly
  âœ“ WCQS_Token â†’ it uses base64url encoding
  âœ“ WCQS_Token â†’ it generates incremental key versions
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it validates mapping configuration                                    Error   
  Call to undefined method stdClass::get_status()

  at src\Utils\WCQS_Mapping.php:201
    197â–• 		if ( $product_id <= 0 ) {
    198â–• 			$errors[] = __( 'Product ID is required', 'wc_qualiopi_steps' );
    199â–• 		} else {
    200â–• 			$product = wc_get_product( $product_id );
  âœ 201â–• 			if ( ! $product || $product->get_status() !== 'publish' ) {
    202â–• 				$errors[] = __( 'Product must exist and be published', 'wc_qualiopi_steps' );
    203â–• 			}
    204â–• 		}
    205â–•

  1   src\Utils\WCQS_Mapping.php:201
  2   tests\Unit\MappingTest.php:204

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it searches in mapping data                                                   
  Failed asserting that an array has the key '123'

  at tests\Unit\MappingTest.php:264
    260â–• 
    261â–•         $results = WCQS_Mapping::search('WordPress');
    262â–•         expect($results)
    263â–•             ->toBeArray()
  âœ 264â–•             ->toHaveKey(123); // Formation WordPress trouvÃ©e
    265â–• 
    266â–•         $results_php = WCQS_Mapping::search('PHP');
    267â–•         expect($results_php)->toHaveKey(124);
    268â–•

  1   tests\Unit\MappingTest.php:264

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it applies default values to product configuration                            
  Failed asserting that an array has the key 'product_id'

  at tests\Unit\MappingTest.php:84
     80â–• 
     81â–•         $config = WCQS_Mapping::get_for_product(100);
     82â–• 
     83â–•         expect($config)
  âœ  84â–•             ->toHaveKey('product_id', 100)
     85â–•             ->toHaveKey('page_id', 200)
     86â–•             ->toHaveKey('form_source', 'learndash') // DÃ©faut
     87â–•             ->toHaveKey('form_ref', '') // DÃ©faut
     88â–•             ->toHaveKey('active', false) // DÃ©faut

  1   tests\Unit\MappingTest.php:84

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it migrates legacy gf_form_id to new structure                                
  Failed asserting that an array has the key 'form_source'

  at tests\Unit\MappingTest.php:106
    102â–• 
    103â–•         $config = WCQS_Mapping::get_for_product(200);
    104â–• 
    105â–•         expect($config)
  âœ 106â–•             ->toHaveKey('form_source', 'gravityforms')
    107â–•             ->toHaveKey('form_ref', '42')
    108â–•             ->not()->toHaveKey('gf_form_id'); // SupprimÃ© aprÃ¨s migration
    109â–•     });
    110â–•

  1   tests\Unit\MappingTest.php:106

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets configuration for specific product                                    
  Failed asserting that null is of type array.

  at tests\Unit\MappingTest.php:57
     53â–•     it('gets configuration for specific product', function () {
     54â–•         $config = WCQS_Mapping::get_for_product(123);
     55â–• 
     56â–•         expect($config)
  âœ  57â–•             ->toBeArray()
     58â–•             ->toHaveKey('product_id', 123)
     59â–•             ->toHaveKey('page_id', 456)
     60â–•             ->toHaveKey('form_source', 'learndash')
     61â–•             ->toHaveKey('form_ref', '789')

  1   tests\Unit\MappingTest.php:57

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it checks if product has active test                                          
  Failed asserting that false is true.

  at tests\Unit\MappingTest.php:125
    121â–•                 return null;
    122â–•             }
    123â–•         }
    124â–• 
  âœ 125â–•         expect(WCQS_Mapping::has_active_test(123))->toBeTrue(); // Active + page existe
    126â–•         expect(WCQS_Mapping::has_active_test(124))->toBeFalse(); // Inactif
    127â–•         expect(WCQS_Mapping::has_active_test(125))->toBeFalse(); // Page manquante
    128â–•         expect(WCQS_Mapping::has_active_test(999))->toBeFalse(); // Produit inexistant
    129â–•     });

  1   tests\Unit\MappingTest.php:125

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets test URL for product                                                  
  Failed asserting that null is of type string.

  at tests\Unit\MappingTest.php:148
    144â–•         }
    145â–• 
    146â–•         $url = WCQS_Mapping::get_test_url(123);
    147â–•         expect($url)
  âœ 148â–•             ->toBeString()
    149â–•             ->toContain('https://example.com/test-page')
    150â–•             ->toContain('product_id=123');
    151â–• 
    152â–•         // Avec paramÃ¨tres personnalisÃ©s

  1   tests\Unit\MappingTest.php:148

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it handles corrupted mapping data gracefully                                  
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:312
    308â–• 
    309â–•         $mapping = WCQS_Mapping::get_mapping();
    310â–•         expect($mapping)
    311â–•             ->toBeArray()
  âœ 312â–•             ->toHaveKey('_version', 1); // Fallback appliquÃ©
    313â–• 
    314â–•         // Configuration produit corrompue
    315â–•         $this->setOption('wcqs_testpos_mapping', [
    316â–•             '_version' => 1,

  1   tests\Unit\MappingTest.php:312

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it provides mapping statistics                                                
  Failed asserting that 0 matches expected 3.

  at tests\Unit\MappingTest.php:226
    222â–•         $stats = WCQS_Mapping::get_stats();
    223â–• 
    224â–•         expect($stats)
    225â–•             ->toBeArray()
  âœ 226â–•             ->toHaveKey('total', 3)
    227â–•             ->toHaveKey('active', 2)
    228â–•             ->toHaveKey('inactive', 1)
    229â–•             ->toHaveKey('problematic')
    230â–•             ->toHaveKey('health_score');

  1   tests\Unit\MappingTest.php:226

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets all products with filtering                                           
  Failed asserting that actual size 0 matches expected size 3.

  at tests\Unit\MappingTest.php:167
    163â–•     it('gets all products with filtering', function () {
    164â–•         $all_products = WCQS_Mapping::get_all_products();
    165â–•         expect($all_products)
    166â–•             ->toBeArray()
  âœ 167â–•             ->toHaveCount(3)
    168â–•             ->toHaveKey(123)
    169â–•             ->toHaveKey(124)
    170â–•             ->toHaveKey(125);
    171â–•

  1   tests\Unit\MappingTest.php:167

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it gets complete mapping with cache                                           
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:46
     42â–•         $mapping2 = WCQS_Mapping::get_mapping(); // DeuxiÃ¨me appel depuis cache
     43â–• 
     44â–•         expect($mapping1)
     45â–•             ->toBeArray()
  âœ  46â–•             ->toHaveKey('_version', 1)
     47â–•             ->toHaveKey('product_123')
     48â–•             ->toHaveKey('product_124');
     49â–• 
     50â–•         expect($mapping2)->toBe($mapping1); // MÃªme rÃ©fÃ©rence = cache utilisÃ©

  1   tests\Unit\MappingTest.php:46

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` â†’ it manages cache correctly                                                    
  Failed asserting that an array has the key 'product_123'

  at tests\Unit\MappingTest.php:279
    275â–• 
    276â–•     it('manages cache correctly', function () {
    277â–•         // Premier accÃ¨s - charge depuis DB
    278â–•         $mapping1 = WCQS_Mapping::get_mapping();
  âœ 279â–•         expect($mapping1)->toHaveKey('product_123');
    280â–• 
    281â–•         // Modifier l'option directement (simulation changement externe)
    282â–•         $this->setOption('wcqs_testpos_mapping', ['_version' => 2, 'product_999' => []]);
    283â–•

  1   tests\Unit\MappingTest.php:279


  Tests:    12 failed, 38 passed (169 assertions)
  Duration: 17.47s

</div>
                    <div class="output" style="background: #721c24;"><strong>ERREUR:</strong><br>Script pest tests/Unit handling the test:unit event returned with error code 2
</div>
                </div>
            </div>

            <div class="test-section">
                <div class="test-header success">
                    Tests logique mÃ©tier 
                    <span class="badge badge-success">SUCCÃˆS</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Unit\CheckoutDecisionTest.php --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   PASS  Tests\Unit\CheckoutDecisionTest
  âœ“ CheckoutDecision â†’ it allows checkout when enforcement is disabled                                                      0.39s  
  âœ“ CheckoutDecision â†’ it allows checkout when no active mapping
  âœ“ CheckoutDecision â†’ it allows checkout with valid temporary token
  âœ“ CheckoutDecision â†’ it allows checkout when test is solved in session
  âœ“ CheckoutDecision â†’ it allows checkout when test is validated in usermeta
  âœ“ CheckoutDecision â†’ it prioritizes temporary token over session validation
  âœ“ CheckoutDecision â†’ it prioritizes session over usermeta validation
  âœ“ CheckoutDecision â†’ it handles multiple products correctly                                                               0.01s  
  âœ“ CheckoutDecision â†’ it ignores usermeta validation for anonymous users
  âœ“ CheckoutDecision â†’ it provides helper methods for decision checking
  âœ“ CheckoutDecision â†’ it converts to array for logging                                                                     0.04s  
  âœ“ CheckoutDecision â†’ it allows checkout when no product in cart
  âœ“ CheckoutDecision â†’ it blocks checkout when no validation proof exists

  Tests:    13 passed (49 assertions)
  Duration: 7.48s

Time: 00:02.005, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Unit\CheckoutDecisionTest.php
 âœ” `CheckoutDecision` â†’ it allows checkout when enforcement is disabled
 âœ” `CheckoutDecision` â†’ it allows checkout when no product in cart
 âœ” `CheckoutDecision` â†’ it allows checkout when no active mapping
 âœ” `CheckoutDecision` â†’ it allows checkout with valid temporary token
 âœ” `CheckoutDecision` â†’ it allows checkout when test is solved in session
 âœ” `CheckoutDecision` â†’ it allows checkout when test is validated in usermeta
 âœ” `CheckoutDecision` â†’ it blocks checkout when no validation proof exists
 âœ” `CheckoutDecision` â†’ it prioritizes temporary token over session validation
 âœ” `CheckoutDecision` â†’ it prioritizes session over usermeta validation
 âœ” `CheckoutDecision` â†’ it handles multiple products correctly
 âœ” `CheckoutDecision` â†’ it ignores usermeta validation for anonymous users
 âœ” `CheckoutDecision` â†’ it provides helper methods for decision checking
 âœ” `CheckoutDecision` â†’ it converts to array for logging

OK, but there were issues!
Tests: 13, Assertions: 49, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header success">
                    Tests sÃ©curitÃ© 
                    <span class="badge badge-success">SUCCÃˆS</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Unit\TokenTest.php --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   PASS  Tests\Unit\TokenTest
  âœ“ WCQS_Token â†’ it creates and verifies a valid token                                                                      0.44s  
  âœ“ WCQS_Token â†’ it creates token with default parameters
  âœ“ WCQS_Token â†’ it rejects expired tokens                                                                                  0.01s  
  âœ“ WCQS_Token â†’ it rejects token with wrong user_id
  âœ“ WCQS_Token â†’ it rejects token with wrong product_id
  âœ“ WCQS_Token â†’ it rejects corrupted tokens
  âœ“ WCQS_Token â†’ it rejects malformed tokens
  âœ“ WCQS_Token â†’ it handles key rotation correctly                                                                          0.18s  
  âœ“ WCQS_Token â†’ it uses base64url encoding
  âœ“ WCQS_Token â†’ it generates incremental key versions                                                                      0.03s  

  Tests:    10 passed (40 assertions)
  Duration: 8.00s

Time: 00:02.692, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Unit\TokenTest.php
 âœ” `WCQS_Token` â†’ it creates and verifies a valid token
 âœ” `WCQS_Token` â†’ it creates token with default parameters
 âœ” `WCQS_Token` â†’ it rejects expired tokens
 âœ” `WCQS_Token` â†’ it rejects token with wrong user_id
 âœ” `WCQS_Token` â†’ it rejects token with wrong product_id
 âœ” `WCQS_Token` â†’ it rejects corrupted tokens
 âœ” `WCQS_Token` â†’ it rejects malformed tokens
 âœ” `WCQS_Token` â†’ it handles key rotation correctly
 âœ” `WCQS_Token` â†’ it uses base64url encoding
 âœ” `WCQS_Token` â†’ it generates incremental key versions

OK, but there were issues!
Tests: 10, Assertions: 40, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header success">
                    Tests sessions 
                    <span class="badge badge-success">SUCCÃˆS</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Unit\SessionTest.php --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   PASS  Tests\Unit\SessionTest
  âœ“ WCQS_Session â†’ it sets and checks solved status                                                                         0.51s  
  âœ“ WCQS_Session â†’ it provides detailed session information                                                                 0.05s  
  âœ“ WCQS_Session â†’ it cannot extend nonexistent sessions
  âœ“ WCQS_Session â†’ it handles multiple products independently
  âœ“ WCQS_Session â†’ it can extend existing sessions                                                                          0.01s  
  âœ“ WCQS_Session â†’ it can unset solved status
  âœ“ WCQS_Session â†’ it respects custom TTL                                                                                   2.01s  
  âœ“ WCQS_Session â†’ it cleans up expired sessions                                                                            2.07s  
  âœ“ WCQS_Session â†’ it provides session statistics                                                                           2.02s  
  âœ“ WCQS_Session â†’ it lists all active sessions                                                                             2.14s  

  Tests:    10 passed (51 assertions)
  Duration: 16.32s

Time: 00:10.698, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Unit\SessionTest.php
 âœ” `WCQS_Session` â†’ it sets and checks solved status
 âœ” `WCQS_Session` â†’ it respects custom TTL
 âœ” `WCQS_Session` â†’ it can unset solved status
 âœ” `WCQS_Session` â†’ it provides detailed session information
 âœ” `WCQS_Session` â†’ it cleans up expired sessions
 âœ” `WCQS_Session` â†’ it lists all active sessions
 âœ” `WCQS_Session` â†’ it can extend existing sessions
 âœ” `WCQS_Session` â†’ it cannot extend nonexistent sessions
 âœ” `WCQS_Session` â†’ it provides session statistics
 âœ” `WCQS_Session` â†’ it handles multiple products independently

OK, but there were issues!
Tests: 10, Assertions: 51, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header error">
                    Tests d'intÃ©gration 
                    <span class="badge badge-error">Ã‰CHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Integration\ --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   FAIL  Tests\Integration\TokenSessionIntegrationTest
  â¨¯ Token Session Integration â†’ it handles token expiration with session cleanup                                            2.86s  
  âœ“ Token Session Integration â†’ it validates complete user journey flow                                                     0.13s  
  âœ“ Token Session Integration â†’ it handles concurrent user sessions correctly
  âœ“ Token Session Integration â†’ it supports token rotation with persistent sessions                                         0.07s  
  âœ“ Token Session Integration â†’ it creates token for validated session user

   PASS  Tests\Integration\CheckoutFlowTest
  âœ“ Checkout Flow Integration â†’ it allows checkout after successful validation                                              0.12s  
  âœ“ Checkout Flow Integration â†’ it handles token-based validation flow
  âœ“ Checkout Flow Integration â†’ it respects enforcement flag configuration
  âœ“ Checkout Flow Integration â†’ it handles multiple products in cart correctly
  âœ“ Checkout Flow Integration â†’ it integrates checkout decision with cart guard logic
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  
   FAILED  Tests\Integration\TokenSessionIntegrationTest > `Token Session Integration` â†’ it handles token expiration with sessiâ€¦   
  Failed asserting that 0 is equal to 1 or is greater than 1.

  at tests\Integration\TokenSessionIntegrationTest.php:57
     53â–•         expect(WCQS_Session::is_solved($product_id))->toBeFalse();
     54â–• 
     55â–•         // 5. Cleanup des sessions expirÃ©es
     56â–•         $cleaned = WCQS_Session::cleanup_expired();
  âœ  57â–•         expect($cleaned)->toBeGreaterThanOrEqual(1);
     58â–•     });
     59â–• 
     60â–•     it('supports token rotation with persistent sessions', function () {
     61â–•         $user_id = 555;

  1   tests\Integration\TokenSessionIntegrationTest.php:57


  Tests:    1 failed, 9 passed (69 assertions)
  Duration: 10.36s

Time: 00:04.989, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Integration\CheckoutFlowTest.php
 âœ” `Checkout Flow Integration` â†’ it integrates checkout decision with cart guard logic
 âœ” `Checkout Flow Integration` â†’ it allows checkout after successful validation
 âœ” `Checkout Flow Integration` â†’ it handles token-based validation flow
 âœ” `Checkout Flow Integration` â†’ it respects enforcement flag configuration
 âœ” `Checkout Flow Integration` â†’ it handles multiple products in cart correctly

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Integration\TokenSessionIntegrationTest.php
 âœ” `Token Session Integration` â†’ it creates token for validated session user
 âœ˜ `Token Session Integration` â†’ it handles token expiration with session cleanup
   â”‚
   â”‚ Failed asserting that 0 is equal to 1 or is greater than 1.
   â”‚
   â”‚ E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Integration\TokenSessionIntegrationTest.php:57
   â”‚
 âœ” `Token Session Integration` â†’ it supports token rotation with persistent sessions
 âœ” `Token Session Integration` â†’ it validates complete user journey flow
 âœ” `Token Session Integration` â†’ it handles concurrent user sessions correctly

FAILURES!
Tests: 10, Assertions: 69, Failures: 1, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header error">
                    Couverture 
                    <span class="badge badge-error">Ã‰CHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> composer test:coverage</div>
                    
                    <div class="output">
  [39;41;1m ERROR [39;49;22m No code coverage driver is available.

</div>
                    <div class="output" style="background: #721c24;"><strong>ERREUR:</strong><br>Script pest --coverage --min=70 handling the test:coverage event returned with error code 1
</div>
                </div>
            </div>

        </div>
        
        <div class="footer">
            <p>Rapport gÃ©nÃ©rÃ© automatiquement le 29/09/2025 Ã  11:37:26</p>
            <p>WC Qualiopi Steps Test Runner v1.0</p>
        </div>
    </div>
</body>
</html>
