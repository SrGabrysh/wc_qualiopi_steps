
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport Tests WC Qualiopi Steps - 20250929_113414</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px 10px 0 0; }
        .header h1 { margin: 0; font-size: 2.5em; }
        .header .meta { opacity: 0.9; margin-top: 10px; }
        .stats { display: flex; justify-content: space-around; padding: 20px; background: #f8f9fa; }
        .stat { text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; }
        .stat-label { color: #666; margin-top: 5px; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .content { padding: 30px; }
        .test-section { margin-bottom: 30px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
        .test-header { padding: 15px; font-weight: bold; font-size: 1.2em; }
        .test-header.success { background: #d4edda; color: #155724; }
        .test-header.error { background: #f8d7da; color: #721c24; }
        .test-content { padding: 20px; }
        .command { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; margin-bottom: 10px; }
        .output { background: #343a40; color: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 0.9em; max-height: 400px; overflow-y: auto; }
        .footer { text-align: center; padding: 20px; color: #666; border-top: 1px solid #dee2e6; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
        .badge-success { background: #28a745; color: white; }
        .badge-error { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Rapport de Tests</h1>
            <div class="meta">
                <strong>WC Qualiopi Steps</strong><br>
                üìÖ 29/09/2025 √† 11:37:26<br>
                üìÅ e:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-number success">3</div>
                <div class="stat-label">Tests R√©ussis</div>
            </div>
            <div class="stat">
                <div class="stat-number error">4</div>
                <div class="stat-label">Tests √âchou√©s</div>
            </div>
            <div class="stat">
                <div class="stat-number">42.9%</div>
                <div class="stat-label">Taux de R√©ussite</div>
            </div>
            <div class="stat">
                <div class="stat-number">7</div>
                <div class="stat-label">Total Tests</div>
            </div>
        </div>
        
        <div class="content">

            <div class="test-section">
                <div class="test-header error">
                    Tests g√©n√©raux 
                    <span class="badge badge-error">√âCHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> composer test</div>
                    
                    <div class="output">
  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   FAIL  Tests\Unit\MappingTest
  ‚®Ø WCQS_Mapping ‚Üí it validates mapping configuration                                                                       0.71s  
  ‚®Ø WCQS_Mapping ‚Üí it manages cache correctly                                                                               0.23s  
  ‚®Ø WCQS_Mapping ‚Üí it gets complete mapping with cache                                                                      0.06s  
  ‚®Ø WCQS_Mapping ‚Üí it applies default values to product configuration                                                       0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it migrates legacy gf_form_id to new structure                                                           0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it gets configuration for specific product                                                               0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it gets test URL for product                                                                             0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it checks if product has active test                                                                     0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it searches in mapping data                                                                              0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it gets all products with filtering                                                                      0.05s  
  ‚®Ø WCQS_Mapping ‚Üí it provides mapping statistics                                                                           0.03s  
  ‚®Ø WCQS_Mapping ‚Üí it handles corrupted mapping data gracefully                                                             0.01s  
  ‚úì WCQS_Mapping ‚Üí it returns null for non-existent product                                                                 0.09s  

   PASS  Tests\Unit\CheckoutDecisionTest
  ‚úì CheckoutDecision ‚Üí it allows checkout when enforcement is disabled                                                      0.16s  
  ‚úì CheckoutDecision ‚Üí it allows checkout when no active mapping
  ‚úì CheckoutDecision ‚Üí it allows checkout with valid temporary token
  ‚úì CheckoutDecision ‚Üí it allows checkout when test is solved in session
  ‚úì CheckoutDecision ‚Üí it allows checkout when test is validated in usermeta
  ‚úì CheckoutDecision ‚Üí it prioritizes temporary token over session validation
  ‚úì CheckoutDecision ‚Üí it prioritizes session over usermeta validation
  ‚úì CheckoutDecision ‚Üí it handles multiple products correctly                                                               0.01s  
  ‚úì CheckoutDecision ‚Üí it ignores usermeta validation for anonymous users
  ‚úì CheckoutDecision ‚Üí it provides helper methods for decision checking
  ‚úì CheckoutDecision ‚Üí it converts to array for logging
  ‚úì CheckoutDecision ‚Üí it allows checkout when no product in cart
  ‚úì CheckoutDecision ‚Üí it blocks checkout when no validation proof exists

   PASS  Tests\Unit\ExampleTest
  ‚úì example                                                                                                                 0.01s  

   PASS  Tests\Unit\SessionTest
  ‚úì WCQS_Session ‚Üí it sets and checks solved status                                                                         0.01s  
  ‚úì WCQS_Session ‚Üí it provides detailed session information
  ‚úì WCQS_Session ‚Üí it cannot extend nonexistent sessions
  ‚úì WCQS_Session ‚Üí it handles multiple products independently
  ‚úì WCQS_Session ‚Üí it can unset solved status
  ‚úì WCQS_Session ‚Üí it can extend existing sessions                                                                          0.01s  
  ‚úì WCQS_Session ‚Üí it respects custom TTL                                                                                   2.01s  
  ‚úì WCQS_Session ‚Üí it cleans up expired sessions                                                                            2.05s  
  ‚úì WCQS_Session ‚Üí it provides session statistics                                                                           2.01s  
  ‚úì WCQS_Session ‚Üí it lists all active sessions                                                                             2.09s  

   PASS  Tests\Unit\SimpleTest
  ‚úì Simple Tests ‚Üí it can run basic assertions                                                                              0.01s  
  ‚úì Simple Tests ‚Üí it can test arrays
  ‚úì Simple Tests ‚Üí it can test PHP functions

   PASS  Tests\Unit\TokenTest
  ‚úì WCQS_Token ‚Üí it rejects token with wrong user_id                                                                        0.01s  
  ‚úì WCQS_Token ‚Üí it rejects token with wrong product_id
  ‚úì WCQS_Token ‚Üí it rejects corrupted tokens
  ‚úì WCQS_Token ‚Üí it rejects malformed tokens
  ‚úì WCQS_Token ‚Üí it uses base64url encoding
  ‚úì WCQS_Token ‚Üí it creates and verifies a valid token
  ‚úì WCQS_Token ‚Üí it creates token with default parameters
  ‚úì WCQS_Token ‚Üí it rejects expired tokens
  ‚úì WCQS_Token ‚Üí it handles key rotation correctly
  ‚úì WCQS_Token ‚Üí it generates incremental key versions
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it validates mapping configuration                                    Error   
  Call to undefined method stdClass::get_status()

  at src\Utils\WCQS_Mapping.php:201
    197‚ñï 		if ( $product_id <= 0 ) {
    198‚ñï 			$errors[] = __( 'Product ID is required', 'wc_qualiopi_steps' );
    199‚ñï 		} else {
    200‚ñï 			$product = wc_get_product( $product_id );
  ‚ûú 201‚ñï 			if ( ! $product || $product->get_status() !== 'publish' ) {
    202‚ñï 				$errors[] = __( 'Product must exist and be published', 'wc_qualiopi_steps' );
    203‚ñï 			}
    204‚ñï 		}
    205‚ñï

  1   src\Utils\WCQS_Mapping.php:201
  2   tests\Unit\MappingTest.php:204

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it manages cache correctly                                                    
  Failed asserting that an array has the key 'product_123'

  at tests\Unit\MappingTest.php:279
    275‚ñï 
    276‚ñï     it('manages cache correctly', function () {
    277‚ñï         // Premier acc√®s - charge depuis DB
    278‚ñï         $mapping1 = WCQS_Mapping::get_mapping();
  ‚ûú 279‚ñï         expect($mapping1)->toHaveKey('product_123');
    280‚ñï 
    281‚ñï         // Modifier l'option directement (simulation changement externe)
    282‚ñï         $this->setOption('wcqs_testpos_mapping', ['_version' => 2, 'product_999' => []]);
    283‚ñï

  1   tests\Unit\MappingTest.php:279

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets complete mapping with cache                                           
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:46
     42‚ñï         $mapping2 = WCQS_Mapping::get_mapping(); // Deuxi√®me appel depuis cache
     43‚ñï 
     44‚ñï         expect($mapping1)
     45‚ñï             ->toBeArray()
  ‚ûú  46‚ñï             ->toHaveKey('_version', 1)
     47‚ñï             ->toHaveKey('product_123')
     48‚ñï             ->toHaveKey('product_124');
     49‚ñï 
     50‚ñï         expect($mapping2)->toBe($mapping1); // M√™me r√©f√©rence = cache utilis√©

  1   tests\Unit\MappingTest.php:46

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it applies default values to product configuration                            
  Failed asserting that an array has the key 'product_id'

  at tests\Unit\MappingTest.php:84
     80‚ñï 
     81‚ñï         $config = WCQS_Mapping::get_for_product(100);
     82‚ñï 
     83‚ñï         expect($config)
  ‚ûú  84‚ñï             ->toHaveKey('product_id', 100)
     85‚ñï             ->toHaveKey('page_id', 200)
     86‚ñï             ->toHaveKey('form_source', 'learndash') // D√©faut
     87‚ñï             ->toHaveKey('form_ref', '') // D√©faut
     88‚ñï             ->toHaveKey('active', false) // D√©faut

  1   tests\Unit\MappingTest.php:84

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it migrates legacy gf_form_id to new structure                                
  Failed asserting that an array has the key 'form_source'

  at tests\Unit\MappingTest.php:106
    102‚ñï 
    103‚ñï         $config = WCQS_Mapping::get_for_product(200);
    104‚ñï 
    105‚ñï         expect($config)
  ‚ûú 106‚ñï             ->toHaveKey('form_source', 'gravityforms')
    107‚ñï             ->toHaveKey('form_ref', '42')
    108‚ñï             ->not()->toHaveKey('gf_form_id'); // Supprim√© apr√®s migration
    109‚ñï     });
    110‚ñï

  1   tests\Unit\MappingTest.php:106

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets configuration for specific product                                    
  Failed asserting that null is of type array.

  at tests\Unit\MappingTest.php:57
     53‚ñï     it('gets configuration for specific product', function () {
     54‚ñï         $config = WCQS_Mapping::get_for_product(123);
     55‚ñï 
     56‚ñï         expect($config)
  ‚ûú  57‚ñï             ->toBeArray()
     58‚ñï             ->toHaveKey('product_id', 123)
     59‚ñï             ->toHaveKey('page_id', 456)
     60‚ñï             ->toHaveKey('form_source', 'learndash')
     61‚ñï             ->toHaveKey('form_ref', '789')

  1   tests\Unit\MappingTest.php:57

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets test URL for product                                                  
  Failed asserting that null is of type string.

  at tests\Unit\MappingTest.php:148
    144‚ñï         }
    145‚ñï 
    146‚ñï         $url = WCQS_Mapping::get_test_url(123);
    147‚ñï         expect($url)
  ‚ûú 148‚ñï             ->toBeString()
    149‚ñï             ->toContain('https://example.com/test-page')
    150‚ñï             ->toContain('product_id=123');
    151‚ñï 
    152‚ñï         // Avec param√®tres personnalis√©s

  1   tests\Unit\MappingTest.php:148

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it checks if product has active test                                          
  Failed asserting that false is true.

  at tests\Unit\MappingTest.php:125
    121‚ñï                 return null;
    122‚ñï             }
    123‚ñï         }
    124‚ñï 
  ‚ûú 125‚ñï         expect(WCQS_Mapping::has_active_test(123))->toBeTrue(); // Active + page existe
    126‚ñï         expect(WCQS_Mapping::has_active_test(124))->toBeFalse(); // Inactif
    127‚ñï         expect(WCQS_Mapping::has_active_test(125))->toBeFalse(); // Page manquante
    128‚ñï         expect(WCQS_Mapping::has_active_test(999))->toBeFalse(); // Produit inexistant
    129‚ñï     });

  1   tests\Unit\MappingTest.php:125

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it searches in mapping data                                                   
  Failed asserting that an array has the key '123'

  at tests\Unit\MappingTest.php:264
    260‚ñï 
    261‚ñï         $results = WCQS_Mapping::search('WordPress');
    262‚ñï         expect($results)
    263‚ñï             ->toBeArray()
  ‚ûú 264‚ñï             ->toHaveKey(123); // Formation WordPress trouv√©e
    265‚ñï 
    266‚ñï         $results_php = WCQS_Mapping::search('PHP');
    267‚ñï         expect($results_php)->toHaveKey(124);
    268‚ñï

  1   tests\Unit\MappingTest.php:264

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets all products with filtering                                           
  Failed asserting that actual size 0 matches expected size 3.

  at tests\Unit\MappingTest.php:167
    163‚ñï     it('gets all products with filtering', function () {
    164‚ñï         $all_products = WCQS_Mapping::get_all_products();
    165‚ñï         expect($all_products)
    166‚ñï             ->toBeArray()
  ‚ûú 167‚ñï             ->toHaveCount(3)
    168‚ñï             ->toHaveKey(123)
    169‚ñï             ->toHaveKey(124)
    170‚ñï             ->toHaveKey(125);
    171‚ñï

  1   tests\Unit\MappingTest.php:167

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it provides mapping statistics                                                
  Failed asserting that 0 matches expected 3.

  at tests\Unit\MappingTest.php:226
    222‚ñï         $stats = WCQS_Mapping::get_stats();
    223‚ñï 
    224‚ñï         expect($stats)
    225‚ñï             ->toBeArray()
  ‚ûú 226‚ñï             ->toHaveKey('total', 3)
    227‚ñï             ->toHaveKey('active', 2)
    228‚ñï             ->toHaveKey('inactive', 1)
    229‚ñï             ->toHaveKey('problematic')
    230‚ñï             ->toHaveKey('health_score');

  1   tests\Unit\MappingTest.php:226

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it handles corrupted mapping data gracefully                                  
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:312
    308‚ñï 
    309‚ñï         $mapping = WCQS_Mapping::get_mapping();
    310‚ñï         expect($mapping)
    311‚ñï             ->toBeArray()
  ‚ûú 312‚ñï             ->toHaveKey('_version', 1); // Fallback appliqu√©
    313‚ñï 
    314‚ñï         // Configuration produit corrompue
    315‚ñï         $this->setOption('wcqs_testpos_mapping', [
    316‚ñï             '_version' => 1,

  1   tests\Unit\MappingTest.php:312


  Tests:    12 failed, 38 passed (169 assertions)
  Duration: 17.26s

</div>
                    <div class="output" style="background: #721c24;"><strong>ERREUR:</strong><br>Script pest handling the test event returned with error code 2
</div>
                </div>
            </div>

            <div class="test-section">
                <div class="test-header error">
                    Tests unitaires uniquement 
                    <span class="badge badge-error">√âCHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> composer test:unit</div>
                    
                    <div class="output">
  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   FAIL  Tests\Unit\MappingTest
  ‚®Ø WCQS_Mapping ‚Üí it validates mapping configuration                                                                       0.74s  
  ‚®Ø WCQS_Mapping ‚Üí it searches in mapping data                                                                              0.32s  
  ‚®Ø WCQS_Mapping ‚Üí it applies default values to product configuration                                                       0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it migrates legacy gf_form_id to new structure                                                           0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it gets configuration for specific product                                                               0.02s  
  ‚®Ø WCQS_Mapping ‚Üí it checks if product has active test                                                                     0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it gets test URL for product                                                                             0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it handles corrupted mapping data gracefully                                                             0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it provides mapping statistics                                                                           0.04s  
  ‚®Ø WCQS_Mapping ‚Üí it gets all products with filtering                                                                      0.05s  
  ‚®Ø WCQS_Mapping ‚Üí it gets complete mapping with cache                                                                      0.01s  
  ‚®Ø WCQS_Mapping ‚Üí it manages cache correctly                                                                               0.01s  
  ‚úì WCQS_Mapping ‚Üí it returns null for non-existent product                                                                 0.10s  

   PASS  Tests\Unit\CheckoutDecisionTest
  ‚úì CheckoutDecision ‚Üí it allows checkout when no product in cart                                                           0.14s  
  ‚úì CheckoutDecision ‚Üí it allows checkout when no active mapping
  ‚úì CheckoutDecision ‚Üí it allows checkout with valid temporary token
  ‚úì CheckoutDecision ‚Üí it allows checkout when test is solved in session
  ‚úì CheckoutDecision ‚Üí it allows checkout when test is validated in usermeta
  ‚úì CheckoutDecision ‚Üí it blocks checkout when no validation proof exists                                                   0.02s  
  ‚úì CheckoutDecision ‚Üí it prioritizes temporary token over session validation
  ‚úì CheckoutDecision ‚Üí it prioritizes session over usermeta validation
  ‚úì CheckoutDecision ‚Üí it ignores usermeta validation for anonymous users
  ‚úì CheckoutDecision ‚Üí it provides helper methods for decision checking
  ‚úì CheckoutDecision ‚Üí it converts to array for logging
  ‚úì CheckoutDecision ‚Üí it handles multiple products correctly
  ‚úì CheckoutDecision ‚Üí it allows checkout when enforcement is disabled

   PASS  Tests\Unit\ExampleTest
  ‚úì example                                                                                                                 0.01s  

   PASS  Tests\Unit\SessionTest
  ‚úì WCQS_Session ‚Üí it can unset solved status                                                                               0.05s  
  ‚úì WCQS_Session ‚Üí it provides detailed session information
  ‚úì WCQS_Session ‚Üí it cannot extend nonexistent sessions
  ‚úì WCQS_Session ‚Üí it handles multiple products independently
  ‚úì WCQS_Session ‚Üí it sets and checks solved status
  ‚úì WCQS_Session ‚Üí it can extend existing sessions                                                                          0.01s  
  ‚úì WCQS_Session ‚Üí it respects custom TTL                                                                                   2.00s  
  ‚úì WCQS_Session ‚Üí it provides session statistics                                                                           2.03s  
  ‚úì WCQS_Session ‚Üí it cleans up expired sessions                                                                            2.01s  
  ‚úì WCQS_Session ‚Üí it lists all active sessions                                                                             2.08s  

   PASS  Tests\Unit\SimpleTest
  ‚úì Simple Tests ‚Üí it can run basic assertions                                                                              0.01s  
  ‚úì Simple Tests ‚Üí it can test arrays
  ‚úì Simple Tests ‚Üí it can test PHP functions

   PASS  Tests\Unit\TokenTest
  ‚úì WCQS_Token ‚Üí it creates and verifies a valid token                                                                      0.01s  
  ‚úì WCQS_Token ‚Üí it creates token with default parameters
  ‚úì WCQS_Token ‚Üí it rejects expired tokens
  ‚úì WCQS_Token ‚Üí it rejects token with wrong user_id
  ‚úì WCQS_Token ‚Üí it rejects token with wrong product_id
  ‚úì WCQS_Token ‚Üí it rejects corrupted tokens
  ‚úì WCQS_Token ‚Üí it rejects malformed tokens
  ‚úì WCQS_Token ‚Üí it handles key rotation correctly
  ‚úì WCQS_Token ‚Üí it uses base64url encoding
  ‚úì WCQS_Token ‚Üí it generates incremental key versions
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it validates mapping configuration                                    Error   
  Call to undefined method stdClass::get_status()

  at src\Utils\WCQS_Mapping.php:201
    197‚ñï 		if ( $product_id <= 0 ) {
    198‚ñï 			$errors[] = __( 'Product ID is required', 'wc_qualiopi_steps' );
    199‚ñï 		} else {
    200‚ñï 			$product = wc_get_product( $product_id );
  ‚ûú 201‚ñï 			if ( ! $product || $product->get_status() !== 'publish' ) {
    202‚ñï 				$errors[] = __( 'Product must exist and be published', 'wc_qualiopi_steps' );
    203‚ñï 			}
    204‚ñï 		}
    205‚ñï

  1   src\Utils\WCQS_Mapping.php:201
  2   tests\Unit\MappingTest.php:204

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it searches in mapping data                                                   
  Failed asserting that an array has the key '123'

  at tests\Unit\MappingTest.php:264
    260‚ñï 
    261‚ñï         $results = WCQS_Mapping::search('WordPress');
    262‚ñï         expect($results)
    263‚ñï             ->toBeArray()
  ‚ûú 264‚ñï             ->toHaveKey(123); // Formation WordPress trouv√©e
    265‚ñï 
    266‚ñï         $results_php = WCQS_Mapping::search('PHP');
    267‚ñï         expect($results_php)->toHaveKey(124);
    268‚ñï

  1   tests\Unit\MappingTest.php:264

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it applies default values to product configuration                            
  Failed asserting that an array has the key 'product_id'

  at tests\Unit\MappingTest.php:84
     80‚ñï 
     81‚ñï         $config = WCQS_Mapping::get_for_product(100);
     82‚ñï 
     83‚ñï         expect($config)
  ‚ûú  84‚ñï             ->toHaveKey('product_id', 100)
     85‚ñï             ->toHaveKey('page_id', 200)
     86‚ñï             ->toHaveKey('form_source', 'learndash') // D√©faut
     87‚ñï             ->toHaveKey('form_ref', '') // D√©faut
     88‚ñï             ->toHaveKey('active', false) // D√©faut

  1   tests\Unit\MappingTest.php:84

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it migrates legacy gf_form_id to new structure                                
  Failed asserting that an array has the key 'form_source'

  at tests\Unit\MappingTest.php:106
    102‚ñï 
    103‚ñï         $config = WCQS_Mapping::get_for_product(200);
    104‚ñï 
    105‚ñï         expect($config)
  ‚ûú 106‚ñï             ->toHaveKey('form_source', 'gravityforms')
    107‚ñï             ->toHaveKey('form_ref', '42')
    108‚ñï             ->not()->toHaveKey('gf_form_id'); // Supprim√© apr√®s migration
    109‚ñï     });
    110‚ñï

  1   tests\Unit\MappingTest.php:106

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets configuration for specific product                                    
  Failed asserting that null is of type array.

  at tests\Unit\MappingTest.php:57
     53‚ñï     it('gets configuration for specific product', function () {
     54‚ñï         $config = WCQS_Mapping::get_for_product(123);
     55‚ñï 
     56‚ñï         expect($config)
  ‚ûú  57‚ñï             ->toBeArray()
     58‚ñï             ->toHaveKey('product_id', 123)
     59‚ñï             ->toHaveKey('page_id', 456)
     60‚ñï             ->toHaveKey('form_source', 'learndash')
     61‚ñï             ->toHaveKey('form_ref', '789')

  1   tests\Unit\MappingTest.php:57

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it checks if product has active test                                          
  Failed asserting that false is true.

  at tests\Unit\MappingTest.php:125
    121‚ñï                 return null;
    122‚ñï             }
    123‚ñï         }
    124‚ñï 
  ‚ûú 125‚ñï         expect(WCQS_Mapping::has_active_test(123))->toBeTrue(); // Active + page existe
    126‚ñï         expect(WCQS_Mapping::has_active_test(124))->toBeFalse(); // Inactif
    127‚ñï         expect(WCQS_Mapping::has_active_test(125))->toBeFalse(); // Page manquante
    128‚ñï         expect(WCQS_Mapping::has_active_test(999))->toBeFalse(); // Produit inexistant
    129‚ñï     });

  1   tests\Unit\MappingTest.php:125

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets test URL for product                                                  
  Failed asserting that null is of type string.

  at tests\Unit\MappingTest.php:148
    144‚ñï         }
    145‚ñï 
    146‚ñï         $url = WCQS_Mapping::get_test_url(123);
    147‚ñï         expect($url)
  ‚ûú 148‚ñï             ->toBeString()
    149‚ñï             ->toContain('https://example.com/test-page')
    150‚ñï             ->toContain('product_id=123');
    151‚ñï 
    152‚ñï         // Avec param√®tres personnalis√©s

  1   tests\Unit\MappingTest.php:148

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it handles corrupted mapping data gracefully                                  
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:312
    308‚ñï 
    309‚ñï         $mapping = WCQS_Mapping::get_mapping();
    310‚ñï         expect($mapping)
    311‚ñï             ->toBeArray()
  ‚ûú 312‚ñï             ->toHaveKey('_version', 1); // Fallback appliqu√©
    313‚ñï 
    314‚ñï         // Configuration produit corrompue
    315‚ñï         $this->setOption('wcqs_testpos_mapping', [
    316‚ñï             '_version' => 1,

  1   tests\Unit\MappingTest.php:312

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it provides mapping statistics                                                
  Failed asserting that 0 matches expected 3.

  at tests\Unit\MappingTest.php:226
    222‚ñï         $stats = WCQS_Mapping::get_stats();
    223‚ñï 
    224‚ñï         expect($stats)
    225‚ñï             ->toBeArray()
  ‚ûú 226‚ñï             ->toHaveKey('total', 3)
    227‚ñï             ->toHaveKey('active', 2)
    228‚ñï             ->toHaveKey('inactive', 1)
    229‚ñï             ->toHaveKey('problematic')
    230‚ñï             ->toHaveKey('health_score');

  1   tests\Unit\MappingTest.php:226

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets all products with filtering                                           
  Failed asserting that actual size 0 matches expected size 3.

  at tests\Unit\MappingTest.php:167
    163‚ñï     it('gets all products with filtering', function () {
    164‚ñï         $all_products = WCQS_Mapping::get_all_products();
    165‚ñï         expect($all_products)
    166‚ñï             ->toBeArray()
  ‚ûú 167‚ñï             ->toHaveCount(3)
    168‚ñï             ->toHaveKey(123)
    169‚ñï             ->toHaveKey(124)
    170‚ñï             ->toHaveKey(125);
    171‚ñï

  1   tests\Unit\MappingTest.php:167

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it gets complete mapping with cache                                           
  Failed asserting that an array has the key '_version'

  at tests\Unit\MappingTest.php:46
     42‚ñï         $mapping2 = WCQS_Mapping::get_mapping(); // Deuxi√®me appel depuis cache
     43‚ñï 
     44‚ñï         expect($mapping1)
     45‚ñï             ->toBeArray()
  ‚ûú  46‚ñï             ->toHaveKey('_version', 1)
     47‚ñï             ->toHaveKey('product_123')
     48‚ñï             ->toHaveKey('product_124');
     49‚ñï 
     50‚ñï         expect($mapping2)->toBe($mapping1); // M√™me r√©f√©rence = cache utilis√©

  1   tests\Unit\MappingTest.php:46

  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Unit\MappingTest > `WCQS_Mapping` ‚Üí it manages cache correctly                                                    
  Failed asserting that an array has the key 'product_123'

  at tests\Unit\MappingTest.php:279
    275‚ñï 
    276‚ñï     it('manages cache correctly', function () {
    277‚ñï         // Premier acc√®s - charge depuis DB
    278‚ñï         $mapping1 = WCQS_Mapping::get_mapping();
  ‚ûú 279‚ñï         expect($mapping1)->toHaveKey('product_123');
    280‚ñï 
    281‚ñï         // Modifier l'option directement (simulation changement externe)
    282‚ñï         $this->setOption('wcqs_testpos_mapping', ['_version' => 2, 'product_999' => []]);
    283‚ñï

  1   tests\Unit\MappingTest.php:279


  Tests:    12 failed, 38 passed (169 assertions)
  Duration: 17.47s

</div>
                    <div class="output" style="background: #721c24;"><strong>ERREUR:</strong><br>Script pest tests/Unit handling the test:unit event returned with error code 2
</div>
                </div>
            </div>

            <div class="test-section">
                <div class="test-header success">
                    Tests logique m√©tier 
                    <span class="badge badge-success">SUCC√àS</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Unit\CheckoutDecisionTest.php --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   PASS  Tests\Unit\CheckoutDecisionTest
  ‚úì CheckoutDecision ‚Üí it allows checkout when enforcement is disabled                                                      0.39s  
  ‚úì CheckoutDecision ‚Üí it allows checkout when no active mapping
  ‚úì CheckoutDecision ‚Üí it allows checkout with valid temporary token
  ‚úì CheckoutDecision ‚Üí it allows checkout when test is solved in session
  ‚úì CheckoutDecision ‚Üí it allows checkout when test is validated in usermeta
  ‚úì CheckoutDecision ‚Üí it prioritizes temporary token over session validation
  ‚úì CheckoutDecision ‚Üí it prioritizes session over usermeta validation
  ‚úì CheckoutDecision ‚Üí it handles multiple products correctly                                                               0.01s  
  ‚úì CheckoutDecision ‚Üí it ignores usermeta validation for anonymous users
  ‚úì CheckoutDecision ‚Üí it provides helper methods for decision checking
  ‚úì CheckoutDecision ‚Üí it converts to array for logging                                                                     0.04s  
  ‚úì CheckoutDecision ‚Üí it allows checkout when no product in cart
  ‚úì CheckoutDecision ‚Üí it blocks checkout when no validation proof exists

  Tests:    13 passed (49 assertions)
  Duration: 7.48s

Time: 00:02.005, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Unit\CheckoutDecisionTest.php
 ‚úî `CheckoutDecision` ‚Üí it allows checkout when enforcement is disabled
 ‚úî `CheckoutDecision` ‚Üí it allows checkout when no product in cart
 ‚úî `CheckoutDecision` ‚Üí it allows checkout when no active mapping
 ‚úî `CheckoutDecision` ‚Üí it allows checkout with valid temporary token
 ‚úî `CheckoutDecision` ‚Üí it allows checkout when test is solved in session
 ‚úî `CheckoutDecision` ‚Üí it allows checkout when test is validated in usermeta
 ‚úî `CheckoutDecision` ‚Üí it blocks checkout when no validation proof exists
 ‚úî `CheckoutDecision` ‚Üí it prioritizes temporary token over session validation
 ‚úî `CheckoutDecision` ‚Üí it prioritizes session over usermeta validation
 ‚úî `CheckoutDecision` ‚Üí it handles multiple products correctly
 ‚úî `CheckoutDecision` ‚Üí it ignores usermeta validation for anonymous users
 ‚úî `CheckoutDecision` ‚Üí it provides helper methods for decision checking
 ‚úî `CheckoutDecision` ‚Üí it converts to array for logging

OK, but there were issues!
Tests: 13, Assertions: 49, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header success">
                    Tests s√©curit√© 
                    <span class="badge badge-success">SUCC√àS</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Unit\TokenTest.php --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   PASS  Tests\Unit\TokenTest
  ‚úì WCQS_Token ‚Üí it creates and verifies a valid token                                                                      0.44s  
  ‚úì WCQS_Token ‚Üí it creates token with default parameters
  ‚úì WCQS_Token ‚Üí it rejects expired tokens                                                                                  0.01s  
  ‚úì WCQS_Token ‚Üí it rejects token with wrong user_id
  ‚úì WCQS_Token ‚Üí it rejects token with wrong product_id
  ‚úì WCQS_Token ‚Üí it rejects corrupted tokens
  ‚úì WCQS_Token ‚Üí it rejects malformed tokens
  ‚úì WCQS_Token ‚Üí it handles key rotation correctly                                                                          0.18s  
  ‚úì WCQS_Token ‚Üí it uses base64url encoding
  ‚úì WCQS_Token ‚Üí it generates incremental key versions                                                                      0.03s  

  Tests:    10 passed (40 assertions)
  Duration: 8.00s

Time: 00:02.692, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Unit\TokenTest.php
 ‚úî `WCQS_Token` ‚Üí it creates and verifies a valid token
 ‚úî `WCQS_Token` ‚Üí it creates token with default parameters
 ‚úî `WCQS_Token` ‚Üí it rejects expired tokens
 ‚úî `WCQS_Token` ‚Üí it rejects token with wrong user_id
 ‚úî `WCQS_Token` ‚Üí it rejects token with wrong product_id
 ‚úî `WCQS_Token` ‚Üí it rejects corrupted tokens
 ‚úî `WCQS_Token` ‚Üí it rejects malformed tokens
 ‚úî `WCQS_Token` ‚Üí it handles key rotation correctly
 ‚úî `WCQS_Token` ‚Üí it uses base64url encoding
 ‚úî `WCQS_Token` ‚Üí it generates incremental key versions

OK, but there were issues!
Tests: 10, Assertions: 40, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header success">
                    Tests sessions 
                    <span class="badge badge-success">SUCC√àS</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Unit\SessionTest.php --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   PASS  Tests\Unit\SessionTest
  ‚úì WCQS_Session ‚Üí it sets and checks solved status                                                                         0.51s  
  ‚úì WCQS_Session ‚Üí it provides detailed session information                                                                 0.05s  
  ‚úì WCQS_Session ‚Üí it cannot extend nonexistent sessions
  ‚úì WCQS_Session ‚Üí it handles multiple products independently
  ‚úì WCQS_Session ‚Üí it can extend existing sessions                                                                          0.01s  
  ‚úì WCQS_Session ‚Üí it can unset solved status
  ‚úì WCQS_Session ‚Üí it respects custom TTL                                                                                   2.01s  
  ‚úì WCQS_Session ‚Üí it cleans up expired sessions                                                                            2.07s  
  ‚úì WCQS_Session ‚Üí it provides session statistics                                                                           2.02s  
  ‚úì WCQS_Session ‚Üí it lists all active sessions                                                                             2.14s  

  Tests:    10 passed (51 assertions)
  Duration: 16.32s

Time: 00:10.698, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Unit\SessionTest.php
 ‚úî `WCQS_Session` ‚Üí it sets and checks solved status
 ‚úî `WCQS_Session` ‚Üí it respects custom TTL
 ‚úî `WCQS_Session` ‚Üí it can unset solved status
 ‚úî `WCQS_Session` ‚Üí it provides detailed session information
 ‚úî `WCQS_Session` ‚Üí it cleans up expired sessions
 ‚úî `WCQS_Session` ‚Üí it lists all active sessions
 ‚úî `WCQS_Session` ‚Üí it can extend existing sessions
 ‚úî `WCQS_Session` ‚Üí it cannot extend nonexistent sessions
 ‚úî `WCQS_Session` ‚Üí it provides session statistics
 ‚úî `WCQS_Session` ‚Üí it handles multiple products independently

OK, but there were issues!
Tests: 10, Assertions: 51, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header error">
                    Tests d'int√©gration 
                    <span class="badge badge-error">√âCHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> .\vendor\bin\pest tests\Integration\ --testdox</div>
                    
                    <div class="output">PHPUnit 10.5.36 by Sebastian Bergmann and contributors.

Runtime:       PHP 8.3.8
Configuration: E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\phpunit.xml


  [30;43;1m WARN [39;49;22m Your XML configuration validates against a deprecated schema. Migrate your XML configuration using "--migrate-configuration"!

  [44;1m INFO [49;22m Bootstrap WC Qualiopi Steps tests loaded.


   FAIL  Tests\Integration\TokenSessionIntegrationTest
  ‚®Ø Token Session Integration ‚Üí it handles token expiration with session cleanup                                            2.86s  
  ‚úì Token Session Integration ‚Üí it validates complete user journey flow                                                     0.13s  
  ‚úì Token Session Integration ‚Üí it handles concurrent user sessions correctly
  ‚úì Token Session Integration ‚Üí it supports token rotation with persistent sessions                                         0.07s  
  ‚úì Token Session Integration ‚Üí it creates token for validated session user

   PASS  Tests\Integration\CheckoutFlowTest
  ‚úì Checkout Flow Integration ‚Üí it allows checkout after successful validation                                              0.12s  
  ‚úì Checkout Flow Integration ‚Üí it handles token-based validation flow
  ‚úì Checkout Flow Integration ‚Üí it respects enforcement flag configuration
  ‚úì Checkout Flow Integration ‚Üí it handles multiple products in cart correctly
  ‚úì Checkout Flow Integration ‚Üí it integrates checkout decision with cart guard logic
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  
   FAILED  Tests\Integration\TokenSessionIntegrationTest > `Token Session Integration` ‚Üí it handles token expiration with sessi‚Ä¶   
  Failed asserting that 0 is equal to 1 or is greater than 1.

  at tests\Integration\TokenSessionIntegrationTest.php:57
     53‚ñï         expect(WCQS_Session::is_solved($product_id))->toBeFalse();
     54‚ñï 
     55‚ñï         // 5. Cleanup des sessions expir√©es
     56‚ñï         $cleaned = WCQS_Session::cleanup_expired();
  ‚ûú  57‚ñï         expect($cleaned)->toBeGreaterThanOrEqual(1);
     58‚ñï     });
     59‚ñï 
     60‚ñï     it('supports token rotation with persistent sessions', function () {
     61‚ñï         $user_id = 555;

  1   tests\Integration\TokenSessionIntegrationTest.php:57


  Tests:    1 failed, 9 passed (69 assertions)
  Duration: 10.36s

Time: 00:04.989, Memory: 12.00 MB

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Integration\CheckoutFlowTest.php
 ‚úî `Checkout Flow Integration` ‚Üí it integrates checkout decision with cart guard logic
 ‚úî `Checkout Flow Integration` ‚Üí it allows checkout after successful validation
 ‚úî `Checkout Flow Integration` ‚Üí it handles token-based validation flow
 ‚úî `Checkout Flow Integration` ‚Üí it respects enforcement flag configuration
 ‚úî `Checkout Flow Integration` ‚Üí it handles multiple products in cart correctly

E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Integration\TokenSessionIntegrationTest.php
 ‚úî `Token Session Integration` ‚Üí it creates token for validated session user
 ‚úò `Token Session Integration` ‚Üí it handles token expiration with session cleanup
   ‚îÇ
   ‚îÇ Failed asserting that 0 is equal to 1 or is greater than 1.
   ‚îÇ
   ‚îÇ E:\Mon Drive\00 - Dev\01 - Codes\Sites web\TB-Formation\dev_plugin_wc_qualiopi_steps\Plugins\wc_qualiopi_steps\tests\Integration\TokenSessionIntegrationTest.php:57
   ‚îÇ
 ‚úî `Token Session Integration` ‚Üí it supports token rotation with persistent sessions
 ‚úî `Token Session Integration` ‚Üí it validates complete user journey flow
 ‚úî `Token Session Integration` ‚Üí it handles concurrent user sessions correctly

FAILURES!
Tests: 10, Assertions: 69, Failures: 1, PHPUnit Deprecations: 1.
</div>
                    
                </div>
            </div>

            <div class="test-section">
                <div class="test-header error">
                    Couverture 
                    <span class="badge badge-error">√âCHEC</span>
                </div>
                <div class="test-content">
                    <div class="command"><strong>Commande:</strong> composer test:coverage</div>
                    
                    <div class="output">
  [39;41;1m ERROR [39;49;22m No code coverage driver is available.

</div>
                    <div class="output" style="background: #721c24;"><strong>ERREUR:</strong><br>Script pest --coverage --min=70 handling the test:coverage event returned with error code 1
</div>
                </div>
            </div>

        </div>
        
        <div class="footer">
            <p>Rapport g√©n√©r√© automatiquement le 29/09/2025 √† 11:37:26</p>
            <p>WC Qualiopi Steps Test Runner v1.0</p>
        </div>
    </div>
</body>
</html>
